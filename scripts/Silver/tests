
-- DETECT AND IDENTIFY THE QUALITY ISSUES OF THE TABLE
/*
===============================================================================
Quality Checks
===============================================================================
Script Purpose:
    This script performs various quality checks for data consistency, accuracy, 
    and standardization across the 'silver' layer. It includes checks for:
    - Null or duplicate primary keys.
    - Unwanted spaces in string fields.
    - Data standardization and consistency.
    - Invalid date ranges and orders.
    - Data consistency between related fields.

Usage Notes:
    - Run these checks after data loading Silver Layer.
    - Investigate and resolve any discrepancies found during the checks.
===============================================================================
*/


-----------------------------------------------------------------------------------------------------
--------------------------crm_cust_info Table---------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------

--------------------------------------1---------------------------------------------------------
-- Check for DUPLICATES OR NULLS in the primary Key
-- Expectation : No Result


SELECT 
*
FROM bronze.crm_cust_info

SELECT
cst_id,
COUNT(*)
FROM bronze.crm_cust_info
GROUP BY cst_id
HAVING COUNT (*) > 1 OR cst_id IS NULL



----------------------------------2------------------------------------------------------
--- Check for unwanted spaces in all String datatype columns
-- Expectation: No Result

--check for firstname Column
SELECT 
cst_firstname
FROM bronze.crm_cust_info
WHERE cst_firstname != TRIM (cst_firstname)

--check for lastname Column
SELECT 
cst_lastname
FROM bronze.crm_cust_info
WHERE cst_lastname != TRIM (cst_lastname)

--check for gndr Column
SELECT 
cst_gender
FROM bronze.crm_cust_info
WHERE cst_gender != TRIM (cst_gender)

--check for Marital status Column

SELECT 
cst_marital_status
FROM bronze.crm_cust_info
WHERE cst_marital_status != TRIM (cst_marital_status)


------------------------------------------------3----------------------------------------------

-- Data Standardization and Consistency

SELECT DISTINCT cst_gender
FROM bronze.crm_cust_info
 --- Change it to Male and Female for M and F--

SELECT DISTINCT cst_marital_status
FROM bronze.crm_cust_info
---- Change it to Married and Single for M and S--


-----------------------------------------------------------------------------------------------------
-------------------crm_prd_info table---------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------


--------------------------------------1---------------------------------------------------------
-- Check for DUPLICATES OR NULLS in the primary Key
-- Expectation : No Result

SELECT 
*
FROM bronze.crm_prd_info

SELECT 
prd_id,
COUNT (*)
FROM bronze.crm_prd_info
Group BY prd_id
HAVING COUNT (*) > 1 OR prd_id IS NULL

-- We did split the string to get the cat_id and prd_key (In data transformation directly)

-- Check for the spaces in prd_nm
-- Expectation : No Result

SELECT 
prd_nm
FROM [bronze].[crm_prd_info]
WHERE prd_nm != TRIM (prd_nm)


-- Check the quality of prd_cost for NUll or Negative numbers
-- Expectation : No Result
-- Found 2 Nulls and changed it to 0 by using ISNULL

SELECT prd_cost
FROM  [Bronze].[crm_prd_info]
WHERE prd_cost < 0 OR prd_cost IS NULL
